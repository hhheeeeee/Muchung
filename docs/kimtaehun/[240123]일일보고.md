2024-01-23 Tue
<br>
 Kim Tae Hun

<pre>

오픈비두 사용
- 튜토리얼 : 카메라, 마이크 사용 가능하게 구현



- 비디오 콜 구현 : 마이크, 채팅, 화면 공유, 본인 닉네임 수정, 전체 화면, -> 카메라는 실패(이유는?) 전원 


추가 할 기능
- 소리가 나오는지 안나오는지 시각적으로 표현
- 채팅창 크기 조절
- 프로필 수정? <- 기존 본인 프로필과 연동해야 함
TURN서버 사용하는 이유? coturn? 확실치 않음



Web RTC를 사용하기 전 기본적으로 익혀야 할 지식들

NAT(Network Address Translation)
-네트워크에서 데이터를 주고 받기 위해서는 public ip 가 필요하다.
NAT는 private ip 를 public ip로 일대일 대응시켜 변환하는 장치를 말한다.
또한 ip 주소를 재기록 하면서 라우터를 통해 네트워크 트래픽을 주고받는 매커니즘이다.

Web RTC 통신은 peer to peer 방식으로 서로 데이터를 주고 받아야 하기 때문에 보내고 받는 peer의 정보(public ip)를 알고 있어야 한다. 그러나 public ip는 요청을 보낼 때마다 private ip -> public ip 로 nat에 의해 바뀌기 때ㅔ문에 동일한 public ip로 통신할 수 없게 된다.
-> STUN, TURN 서버를 사용해서 문제를 해결할 수 있다.

ICE(interactive connectivity establishment)

-ICE의 목표는 두 장치간의 통신을 가능하게 하기 위해 가능한 초ㅚ상의 네트워크 경로를 찾는 것이다. 이를 ㅜ이해 다양한 네트워크 경로를 시도하고, 방홤벽과 NAT과 같은 네트워크 장치들을 통과할 수 있는 연결을 설정한다.

ice는 두 단말이 서로 통신할 수 있는 최적의 경로를 찾을 수 있도록 도와주는 프레임워크이다.
최적의 경로 -> TURN, STUN 서버를 사용하여 최적의 경로를 찾는다.

모든 단말은 각자의 환경이 다양하기에 peer A에서 peer B까지 단순하게 연결되지 않는다. 방화벽이 존재하는 환경에서는 방화벽을 통과해야 하고 단말의 퍼블릭 ip가 없다면 유일한 주소값을 할당해야 하고, 라우터가 peer간의 직접연결을 허용하지 않을 때는 데이터를 릴레이 해야 한다.
ICE 프로세스를 사용하면 nat가 통신을 위해 필요한 모든 포트를 열어두고 두 엔드 포인트를 모두 다 연결할 수 있는 ip주소, 포트에 대한 완전한 정보를 갖게 된다. 결국, 요청하는 클라이언트와 미디어 서버 사이의 연결을 통해 미디어(비디오, 음성) 등을 주고 받을 수 있다.

ICE 혼자는 작동하지 않으며 STUN과 TURN 서버를 사용해야 한다.

STUN(session traversal utilities for NAT)
공개 주소를 발견하거나 peer 간의 직접 연결을 막는 등 라우터의 제한을 결정하며 ICE를 보완하는 프로토콜이다. 간단하게 말하면 STUN서버는 해당 peer의 public ip 주소를 보내는 역할을 한다.
stun은 두 엔드 포인트 간의 연결을 확인하고 NAT 바인딩을 유지하기 위한 연결 유지 프로토콜로도 사용할 수 있다.
하지만 두 단말이 같은 NAT 환경에 있을 경우 또는 NAT의 보안정책이 엄격하거나 드으이 이유에 따라 STUN이 완벽한 해결책이 되지는 않는다.

TURN(Traversal Using Relays around NAT)
STUN의 확장으로  NAT 환경에서 릴레이하여 통신을 하게 된다.
NAT 보안 정책이 너무 엄격하거나 NAT 순회를 하기 위해 필요한 NAT 바인딩을 성공적으로 생성할 수 없는 경우에 TURN을 사용한다.
YURN서버는 인터넷망에 위치하고 각 peer(단말)들이 사설망(private ip)안에서 통신한다. 각 peer들이 직접 통신하는 것이 아니라 릴레이 역할을 하는 TURN 서버를 사용하여 경유한다.
TURN은 이러한 릴레이로부터 IP  주소와 포트를 클라이언트가 취득할 수 있는 릴레이 주소를 할당한다.
TURN의 문제점
클라이언트와의 연결을 거의 항상 제공하지만 STUN에 비해 리소스 낭비가 심하다. 그렇기 때문에 ICE candidate 과정에서 local IP로 연결할 수 있는지, public ip로 연결할 수 있는지를 (모든 후보군을 찾은 후)알아낸 후 최후의 수단으로 사용해야 한다.

ICE candidate gathering
local address, server reflexive address, relayed address 등 통신 가능한 주소들을 모두 가져온다. 이 주소들 중 가장 최적의 경로를 찾아서 연결시켜준다.


openvidu

OpenVidu를 사용하여 그룹화상회의를 구현할 때, 세 가지 주요 요소인 OpenVidu 배포, 서버 애플리케이션, 그리고 클라이언트 애플리케이션이 필요합니다. 각각의 역할과 목적은 다음과 같습니다:

1. **OpenVidu 배포 (OpenVidu Deployment):**
   - **목적:** OpenVidu 배포는 OpenVidu 서버와 관련된 여러 구성 요소들을 설치하고 설정하여 확장 가능하고 안정적인 환경을 구축하는 것을 목적으로 합니다.
   - **구성 요소:**
      - **OpenVidu 서버:** WebRTC 기반의 미디어 서버로, 영상 및 음성 통화를 관리하고 제어합니다.
      - **Kurento 미디어 서버:** OpenVidu의 미디어 처리를 담당하는 서버로, 미디어 스트리밍 및 레코딩과 같은 기능을 제공합니다.
      - **Coturn (TURN 서버):** NAT 환경에서의 원활한 연결을 지원하기 위해 사용되는 TURN 서버입니다.
   - **배포 위치:** 클라우드 환경(AWS, Azure, GCP 등)이나 온프레미스 서버에서 OpenVidu를 배포할 수 있습니다.

2. **서버 애플리케이션 (Server Application):**
   - **목적:** 서버 애플리케이션은 OpenVidu 서버와 상호 작용하며 클라이언트 애플리케이션과 미디어 통신을 조정합니다. 이 애플리케이션은 OpenVidu API를 사용하여 세션 관리, 미디어 스트리밍 및 이벤트 처리를 수행합니다.
   - **구성 요소:**
      - **OpenVidu 서버 API 호출:** OpenVidu의 RESTful API를 사용하여 세션 및 토큰 생성, 미디어 스트리밍 제어 등을 수행합니다.
      - **이벤트 핸들링:** OpenVidu에서 발생하는 이벤트(회의 시작, 종료, 사용자 참여 등)를 처리하고 클라이언트에 전달합니다.
   - **기능:** 그룹화상회의의 비즈니스 로직을 처리하며, OpenVidu의 미디어 관리와 상호 작용합니다.

3. **클라이언트 애플리케이션 (Client Application):**
   - **목적:** 클라이언트 애플리케이션은 사용자 인터페이스를 통해 그룹화상회의에 참여하고 미디어를 표시하며, OpenVidu 서버와 상호 작용합니다.
   - **구성 요소:**
      - **OpenVidu 클라이언트 라이브러리:** OpenVidu의 클라이언트 라이브러리를 사용하여 브라우저에서 미디어 스트리밍 및 통신을 처리합니다.
      - **웹 브라우저 인터페이스(UI):** 사용자에게 그룹화상회의를 시작하거나 참여할 수 있는 웹 기반 UI를 제공합니다.
   - **기능:** 미디어 스트리밍 및 사용자 간의 상호 작용을 처리하며, 사용자 인터페이스를 통해 그룹화상회의 기능을 제공합니다.

이렇게 구성된 세 가지 요소는 OpenVidu를 활용하여 그룹화상회의를 구현하고 관리하는 데 필요한 핵심 구성 요소들입니다. OpenVidu 배포는 안정적인 서버 환경을 제공하고, 서버 애플리케이션은 OpenVidu와 비즈니스 로직 간의 상호 작용을 담당하며, 클라이언트 애플리케이션은 사용자가 실제로 그룹

화상회의에 참여할 수 있는 환경을 제공합니다.


</pre>